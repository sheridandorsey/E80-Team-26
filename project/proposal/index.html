<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>E80 SP24 - E80 Project Design and Proposal</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">E80 SP24</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../lectures/"> 
<span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="../../labs/overview">
 <span class="dropdown-text">Lab Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab0">
 <span class="dropdown-text">Lab 0: Tutorial &amp; Skills Review</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab1">
 <span class="dropdown-text">Lab 1: Go Autonomous</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab2">
 <span class="dropdown-text">Lab 2: BEM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab3">
 <span class="dropdown-text">Lab 3: Op-Amps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab4">
 <span class="dropdown-text">Lab 4: Temperature</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab5">
 <span class="dropdown-text">Lab 5: Acoustics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../labs/lab6">
 <span class="dropdown-text">Lab 6: Fluids</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-project" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Project</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-project">    
        <li>
    <a class="dropdown-item" href="../../project/overview">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../project/proposal">
 <span class="dropdown-text">Design and Proposal</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../project/navigation">
 <span class="dropdown-text">Navigation Jump Start</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../project/build">
 <span class="dropdown-text">Build and Integrate</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../project/field">
 <span class="dropdown-text">Field Deployment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../project/report">
 <span class="dropdown-text">Present and Report</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-references" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">References</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-references">    
        <li>
    <a class="dropdown-item" href="../../reference/inventory">
 <span class="dropdown-text">Lab Inventory</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/equipment">
 <span class="dropdown-text">Lab Equipment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/board">
 <span class="dropdown-text">Board Information</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../reference/design">
 <span class="dropdown-text">Reference Designs</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../history/"> 
<span class="menu-text">History</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/HMC-E80/E80"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#one-page-description" id="toc-one-page-description" class="nav-link" data-scroll-target="#one-page-description">One-Page Description</a></li>
  <li><a href="#budget" id="toc-budget" class="nav-link" data-scroll-target="#budget">Budget</a></li>
  <li><a href="#mechanical-drawings" id="toc-mechanical-drawings" class="nav-link" data-scroll-target="#mechanical-drawings">Mechanical Drawings</a></li>
  <li><a href="#schematics" id="toc-schematics" class="nav-link" data-scroll-target="#schematics">Schematics</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">E80 Project Design and Proposal</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Specifications: <a href="../../project/proposal/submission.html">html</a> <a href="../../project/proposal/submission.docx">Word</a></p>
<p>Template: <a href="../../project/proposal/template.html">html</a> <a href="../../project/proposal/template.docx">Word</a></p>
<p>Examples: <a href="assets/Project Proposal_example_1_.pdf">pdf</a> <a href="assets/Project Proposal _example_2_.pdf">pdf</a></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>You will need to produce a project proposal and have it approved by <strong>TWO</strong> professors before spring break. The project proposal is made up of four parts:</p>
<ol type="1">
<li>A one-page maximum written description of your experiment,</li>
<li>A budget indicating what you intend to buy for the project,</li>
<li>A mechanical drawing showing how you plan to mount or ruggedize the sensors for water submersion,</li>
<li>A detailed schematic showing how you will connect your new sensors to power and to the Teensy.</li>
</ol>
<p>The following sections describe each deliverable. Note that an example proposal is linked above.</p>
</section>
<section id="one-page-description" class="level2">
<h2 class="anchored" data-anchor-id="one-page-description">One-Page Description</h2>
<p>You must write a one-page description of your project that lays out your scientific and/or engineering goals and describes how your sensor system will help you meet those goals. There are a few specific points that it should address:</p>
<ul>
<li>It should answer the question, “Why would anyone do this project?” or “Why should I care about your results?”</li>
<li>It should outline your hypothesis and what you’re comparing it to: what is the <em>x</em> of your experiment, what is the <em>y</em> and what two <em>x</em>-<em>y</em> curves are you comparing? If you need to cite literature to establish your scientific relationship, then don’t forget you can access papers through Mudd’s network.</li>
<li>It should state the sensors you are using and describe how they relate to your scientific/engineering goals.</li>
<li>If should, in text, describe where exceptional mechanical, electrical or software design is required. No need to point out every op-amp, just fancy/abnormal stuff.</li>
<li>It should convince the reader that you considered a number of design alternatives when you picked your project. The minimum bar for doing this is including five two-line project descriptions for projects that you considered but did not pursue.</li>
<li>It should outline requests for specific launch times or locations for your robot.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Launch Locations
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There are two locations we can launch in Dana Point: the public beach and the Ocean Institute pier. We have a limited number of launch slots on the pier: two teams can launch in each half hour slot from 8:30 a.m. to 2:30 p.m. If your scientific goals would benefit from a particular launch time slot or slots on the pier, then you should request those slots in this project description. If some time slots are oversubscribed, we will award them randomly. We will prioritize giving every team that wants one a deployment off the pier over giving one team multiple deployments.</p>
</div>
</div>
</div>
</section>
<section id="budget" class="level2">
<h2 class="anchored" data-anchor-id="budget">Budget</h2>
<p>You must prepare a budget for your final project. <strong>You have $50 to spend</strong> on the project, and you may not augment that amount with personal money, student project grants or any other source of funds. Your budget only needs to include sensors and other parts (e.g.: motors), and it should exclude parts that you plan to use from our inventory, which is freely available to you.</p>
<p>To capture your budget, prepare a spreadsheet that contains the following for each part you intend to purchase:</p>
<ul>
<li>Plain English description. e.g.: “Pressure Sensor”.</li>
<li>Part number. e.g.: “MPX5700”.</li>
<li>Unit price before tax and shipping.</li>
<li>Tax costs.</li>
<li>Shipping costs. Note that you can defray shipping costs by ordering multiple parts from one vendor.</li>
<li>Link to vendor site.</li>
<li>Link to datasheet.</li>
</ul>
<p>Common vendors include <a href="http://www.digikey.com/">Digikey</a>, <a href="https://www.mcmaster.com/">McMaster-Carr</a>, <a href="http://www.jameco.com/">JameCo</a>, <a href="https://www.sparkfun.com/">SparkFun</a>, <a href="https://www.adafruit.com/">AdaFruit</a> and many others.</p>
<p>Completing this budget will require you to name specific sensors and mechanical parts and to report their prices. Therefore, you are expected to have selected parts for your experiment before submitting the budget. When you select parts, be sure to qualify them for your mission: do they have the necessary signal input range? an acceptable electrical interface? etc.</p>
<p><a href="../../reference/inventory">Parts already in lab</a> are freely available to you, therefor this budget does not need to include parts that we already have in lab (since you won’t buy them). Some of the lab supplies, notably speakers and microphones, are not available for permanent installation, but they are available for temporary checkout for prototyping. These supplies are cheap enough that we expect you to buy your own for permanent installation.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caveat emptor! i.e.: Let the Buyer Beware
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Surface mounted (SMT) parts are generally hard for students to work with. You need to buy an adapter board for your part if you are buying something surface mounted.</li>
<li>If you use a part with a digital interface, be careful of I2C, UART and SPI. Using any of these will require a bigger software effort than sampling an analog signal.</li>
<li>We have found that off the shelf ultrasound transducers don’t perform well underwater. Though it’s hard, it’s better to build your own out of our parts.</li>
</ul>
</div>
</div>
<p>Once you have prepared your budget, you must check it off and then submit a purchase order:</p>
<ol type="1">
<li>Get necessary approvals:
<ul>
<li>All purchases must be approved by your section instructor, who will initial your purchase requests on the tracking spreadsheet.</li>
<li>All purchases must be approved by a second instructor, who will also initial your purchase request on the tracking spreadsheet.</li>
<li>You must ensure that the professors record your designated buyer; the <strong>ONE</strong> person on your team who is allowed to submit purchase orders.</li>
<li>You will not be approved if your order is over $50. DO NOT FORGET TAXES AND SHIPPING when preparing your budget.</li>
</ul></li>
<li>Prepare a purchase order:
<ul>
<li><a href="https://www.hmc.edu/engineering/current-student-information/department-forms/">New Purchase Order Request Form</a></li>
<li>Arrange for purchases to be shipped to the Engineering Department.</li>
<li>Include your team number and section number in a description field.</li>
<li>List Professor Brake as the professor to approve the purchase request.</li>
</ul></li>
</ol>
<p>Purchases have a relatively long lead time, around a week. However, if your proposal is approved before spring break, then that lead time will be hidden by the break.</p>
</section>
<section id="mechanical-drawings" class="level2">
<h2 class="anchored" data-anchor-id="mechanical-drawings">Mechanical Drawings</h2>
<p>You must prepare mechanical drawings of your robot.</p>
<p>These drawings are intended to be concept drawings so that your professors can discuss the design with you, not full models for manufacturing. Therefore, please sketch these drawings (either by hand or in a drawing program) and please DO NOT provide a SolidWorks model.</p>
<p>Your mechanical drawings should allow a professor to evaluate important design decisions. Therefore, do the following:</p>
<ul>
<li>Indicate motor locations. Careful to keep them as far from your IMU as possible to keep the magnetometer happy.</li>
<li>Indicate sensor locations.</li>
<li>Indicate penetrator locations and note the number of wires passing through each penetrator.</li>
<li>Sketch the wiring harness and how it’s fastened to the robot.</li>
<li>Include approximate calculations of mass, center of gravity, buoyancy, center of pressure, and (if necessary) ballast.</li>
<li>If you’re doing something bold, calculate the required torque for your motors. Motor datasheets can help.</li>
<li>Include a brief paragraph summarizing major design decisions. e.g.: “It’s flat and wide because we wanted a raft.”</li>
</ul>
</section>
<section id="schematics" class="level2">
<h2 class="anchored" data-anchor-id="schematics">Schematics</h2>
<p>Make a schematic that adheres to good practice (as outlined in <a href="../../labs/lab3/submission.html">lab 3 specs</a>) and that includes all of your sensor interface circuits. Your schematic should be a comprehensive design document, so do the following:</p>
<ul>
<li>Show every wire, resistor, capacitor (don’t forget bypass capacitors), and power source (i.e.: battery) that you intend to assemble into your final design.<br>
</li>
<li>Annotate the expected Voltage swing on every node of the schematic.</li>
<li>Check that none of the Teensy pin nodes swing above 3.3 V or below 0 V.</li>
<li>Where appropriate, include relevant reference designs from datasheets (with citation) to justify your schematic choices.</li>
<li>Though we’re not requiring simulations of your design here, having a working simulation of the design is a great idea.</li>
<li>Split this big schematic into multiple smaller ones if it makes it easier to read. (It may still make sense to submit one big schematic, but consider whether a big schematic or several small ones will serve you better.)</li>
</ul>
<p>All of your new electronics will be assembled on a new board called the protoboard. We discuss the protoboard in greater details during the <a href="../../project/build">build</a>, but its limited size should inform your circuit design. The protoboard has the same number of rows as a standard breadboard, so don’t pick designs that require more wires than would fit on a breadboard.</p>
<p>You may find the design files for the PCBs you will use helpful while coming up with your schematic, so they are linked below. The CAD files for each board are viewable using <a href="http://kicad.org/">KiCAD</a>.</p>
<ul>
<li>Motherboard
<ul>
<li><a href="https://drive.google.com/file/d/1pk_mORYsxhedKjjqzhMrxj9H5ZVH3zqp/view?usp=sharing">schematic</a>,</li>
<li><a href="https://drive.google.com/file/d/1pmm8xwpyAHAL5YvwMIQma4W8DuV-MP31/view?usp=sharing">layout</a>,</li>
<li><a href="https://drive.google.com/file/d/1pi9WNW7WoIx80xgb_0LWSUyA-LMfp94Z/view?usp=sharing">CAD files</a></li>
<li><a href="https://drive.google.com/file/d/18bMajGNwH1K2yHB1dQLZRx5eqrYiNQWA/view?usp=sharing">Introduction to the E80 Motherboard</a> document from lab 1.</li>
</ul></li>
<li>Protoboard
<ul>
<li><a href="https://drive.google.com/open?id=1pDpDoSiCln73AbEeGSCm-o7L3ETTjlG9">schematic</a>,</li>
<li><a href="https://drive.google.com/open?id=1VT_N11I8Alo8cQPUag5moUuXnGed80gd">layout</a>,</li>
<li><a href="https://drive.google.com/open?id=1NZ2dgC0PsSTcEsx0r2AD4S_84Wv5dpuq">CAD files</a></li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>